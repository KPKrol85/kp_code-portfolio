(()=>{const e=document.querySelectorAll(".hidden");if(!e.length)return;if(!("IntersectionObserver"in window))return void e.forEach(e=>e.classList.add("show"));const t=.12,n=new IntersectionObserver(e=>{e.forEach(e=>{e.intersectionRatio>t?requestAnimationFrame(()=>e.target.classList.add("show")):0===e.intersectionRatio&&e.target.classList.remove("show")})},{root:null,rootMargin:"0px 0px -10% 0px",threshold:[0,t,.5,1]});e.forEach(e=>n.observe(e));const a=()=>{e.forEach(e=>{((e,t=.12)=>{const n=e.getBoundingClientRect(),a=window.innerHeight||document.documentElement.clientHeight,s=window.innerWidth||document.documentElement.clientWidth;if(0===n.width||0===n.height)return!1;const i=Math.min(n.bottom,a)-Math.max(n.top,0),o=Math.min(n.right,s)-Math.max(n.left,0);return!(i<=0||o<=0)&&i*o/(n.width*n.height)>t})(e)&&e.classList.add("show")})};requestAnimationFrame(()=>{requestAnimationFrame(a)}),window.addEventListener("load",()=>{setTimeout(a,0)},{once:!0}),window.addEventListener("pageshow",()=>{setTimeout(a,0)},{once:!0})})(),(()=>{const e=document.getElementById("themeToggleDesktop"),t=document.getElementById("themeToggleMobile"),n=document.querySelectorAll(".logo-img[data-light][data-dark]"),a=document.getElementById("hamburgerIcon"),s=window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null,i=(s,i=!0)=>{const o="dark"===s;document.body.classList.toggle("dark-mode",o),(e=>{n.forEach(t=>{const n=e?t.dataset.dark:t.dataset.light;if(!n)return;const a=new URL(n,document.baseURI).href;t.src!==a&&t.setAttribute("src",n)})})(o),(e=>{if(!a)return;const t=e?a.dataset.dark:a.dataset.light;t&&a.getAttribute("src")!==t&&a.setAttribute("src",t)})(o),(n=>{const a=String(n),s=n?"Przełącz na jasny motyw":"Przełącz na ciemny motyw";e&&(e.setAttribute("aria-pressed",a),e.setAttribute("aria-label",s)),t&&(t.setAttribute("aria-pressed",a),t.setAttribute("aria-label",s))})(o),i&&((e,t)=>{try{localStorage.setItem(e,t)}catch{}})("theme",o?"dark":"light")},o=(e=>{try{return localStorage.getItem(e)}catch{return null}})("theme");i("dark"===o||"light"===o?o:s&&s.matches?"dark":"light",!1);const r=()=>{const e=document.body.classList.contains("dark-mode")?"light":"dark";i(e,!0)};if(e&&e.addEventListener("click",r),t&&t.addEventListener("click",r),!o&&s){const e=e=>i(e.matches?"dark":"light",!1);s.addEventListener?s.addEventListener("change",e):s.addListener&&s.addListener(e)}})(),(()=>{const e=document.getElementById("hamburger"),t=document.getElementById("primaryNav");if(!e||!t)return;e.hasAttribute("aria-expanded")||e.setAttribute("aria-expanded","false");const n=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),document.body.classList.remove("nav-open")};e.addEventListener("click",()=>{const n=!t.classList.contains("mobile-open");t.classList.toggle("mobile-open",n),e.classList.toggle("active",n),e.setAttribute("aria-expanded",String(n)),e.setAttribute("aria-label",n?"Zamknij menu":"Otwórz menu"),document.body.classList.toggle("nav-open",n)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("mobile-open")&&n()}),t.addEventListener("click",e=>{e.target.closest("a[href], area[href]")&&n()});const a=window.matchMedia("(max-width: 768px)"),s=()=>{a.matches||n()};a.addEventListener?a.addEventListener("change",s):a.addListener&&a.addListener(s)})(),(()=>{const e=document.getElementById("powrot-na-gore")||document.querySelector(".powrot-na-gore");if(!e)return;const t=()=>{e.classList.toggle("is-visible",("number"==typeof window.pageYOffset?window.pageYOffset:(document.scrollingElement||document.documentElement).scrollTop)>300)};let n=!1;t(),window.addEventListener("load",t,{once:!0}),window.addEventListener("pageshow",t,{once:!0}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&t()}),window.addEventListener("resize",t),window.addEventListener("scroll",()=>{n||(n=!0,requestAnimationFrame(()=>{t(),n=!1}))},{passive:!0}),e.addEventListener("click",t=>{if(t.preventDefault(),!e.classList.contains("is-visible"))return;const n=!window.matchMedia("(prefers-reduced-motion: reduce)").matches;window.scrollTo({top:0,behavior:n?"smooth":"auto"})})})(),(()=>{const e=document.getElementById("contactForm");if(!e)return;const t=/localhost|127\.0\.0\.1/.test(location.hostname),n=e.querySelector("#formStatus"),a=e.querySelector(".submit-btn"),s=a?a.textContent:"Wyślij wiadomość",i=["name","email","subject","service","message"],o=e.querySelector("#message"),r=document.getElementById("messageCounter"),c=500,d=e.querySelector("#errorSummary"),l=e.querySelector("#skipToError");l&&l.addEventListener("click",t=>{t.preventDefault();const n=e.querySelector(".is-invalid");n&&n.focus()}),e.addEventListener("keydown",t=>{const n=t.key||t.code;if(t.altKey&&t.shiftKey&&("E"===n||"KeyE"===n)){const n=e.querySelector(".is-invalid");n&&(t.preventDefault(),n.focus())}});const u=e=>{e&&(e.classList.add("is-invalid"),e.setAttribute("aria-invalid","true"))},m=(e,t=!1)=>{n&&(n.classList.toggle("ok",!!t),n.classList.toggle("err",!t),n.textContent=e)};function g(){if(!o||!r)return;o.value.length>c&&(o.value=o.value.slice(0,c));const e=o.value.length;r.textContent=`${e}/500`,r.classList.toggle("warn",e>=450&&e<c),r.classList.toggle("limit",e>=c)}g();const h="contactFormMessage";if(o){const e=(()=>{try{return localStorage.getItem(h)}catch{return null}})();e&&(o.value=e,g()),o.addEventListener("input",()=>{try{localStorage.setItem(h,o.value)}catch{}})}e.addEventListener("input",t=>{const n=t.target;var a;n.matches("#name, #email, #subject, #service, #message, #phone, #consent")&&((a=n)&&(a.classList.remove("is-invalid"),a.removeAttribute("aria-invalid"))),n===o&&g(),[...e.querySelectorAll(".is-invalid")].length||(d&&d.classList.add("visually-hidden"),l&&l.classList.add("visually-hidden"))}),e.addEventListener("submit",async r=>{if(r.preventDefault(),"true"===e.getAttribute("aria-busy"))return;m("",!1);let v=!0;i.forEach(t=>{const n=e.querySelector("#"+t);n&&n.value&&n.value.trim()||(u(n),v=!1)});const y=e.querySelector("#email"),b=y?y.value.trim():"";y&&b&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)&&(u(y),v=!1,m("Wpisz poprawny adres e-mail.",!1));const w=e.querySelector("#phone");if(w){const e=w.value.trim();e&&!/^[0-9 +()-]{7,20}$/.test(e)&&(u(w),v=!1,m("Wpisz poprawny numer telefonu (np. +48 600 000 000).",!1))}const f=e.querySelector("#consent");f&&!f.checked&&(u(f),v=!1,m("Zaznacz zgodę na przetwarzanie danych.",!1));if(e.querySelector("[data-recaptcha]")&&!t){const t=e.querySelector('[name="g-recaptcha-response"]');t&&t.value||(v=!1,m("Potwierdź, że nie jesteś robotem (reCAPTCHA).",!1))}if(o&&o.value.length>c&&(u(o),v=!1,m("Wiadomość może mieć maks. 500 znaków.",!1)),!v){const t=[...e.querySelectorAll(".is-invalid")];if(d){const n=t.map(t=>{const n=t.id?e.querySelector(`label[for="${t.id}"]`):null;return n?n.textContent.trim():t.name||t.id||"Pole"}),a=t.length,s=1===a?"błąd":a>=2&&a<=4?"błędy":"błędów";d.textContent=`Formularz zawiera ${a} ${s}: ${n.join(", ")}.`,d.classList.remove("visually-hidden")}l&&l.classList.remove("visually-hidden");const a=t[0];return a&&a.focus(),void(n&&!n.textContent&&m("Uzupełnij wymagane pola.",!1))}e.setAttribute("aria-busy","true"),a&&(a.disabled=!0,a.classList.add("sending"),a.textContent="Wysyłanie…"),m("Wysyłanie…",!0);const p=new FormData(e),L=new URLSearchParams(p).toString();try{if(t)await new Promise(e=>setTimeout(e,500));else{if(!(await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:L})).ok)throw new Error("Netlify response not OK")}e.setAttribute("aria-busy","false"),e.reset();try{localStorage.removeItem(h)}catch{}g(),m("Dziękujemy! Wiadomość została wysłana.",!0),a&&(a.classList.remove("sending"),a.classList.add("sent"),a.textContent="Wysłano ✓",setTimeout(()=>{a.disabled=!1},1200),setTimeout(()=>{m("",!0),a.classList.remove("sent"),a.textContent=s},6e3)),d&&d.classList.add("visually-hidden"),l&&l.classList.add("visually-hidden"),t||("function"==typeof gtag&&gtag("event","generate_lead",{event_category:"Formularz",event_label:"Kontakt — Budownictwo"}),"function"==typeof fbq&&fbq("track","Lead"))}catch(t){e.setAttribute("aria-busy","false"),a&&(a.disabled=!1,a.classList.remove("sending"),a.textContent=s),m("Ups! Nie udało się wysłać. Spróbuj ponownie za chwilę.",!1),console.error(t)}})})(),(()=>{const e=document.getElementById("lightbox");if(!e)return;const t=e.querySelector(".lb__img"),n=e.querySelector(".lb__caption"),a=e.querySelector(".lb__close"),s=e.querySelector(".lb__backdrop");let i=null,o=[],r=null,c=null;const d=window.matchMedia?window.matchMedia("(hover: none) and (pointer: coarse)").matches:"ontouchstart"in window,l=(s,d)=>{i=document.activeElement,t.src=s,t.alt=d||"",d&&d.trim()?(n.textContent=d,n.hidden=!1):(n.textContent="",n.hidden=!0),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("lb-open"),o=Array.from(e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled")&&null!==e.offsetParent),r=o[0],c=o[o.length-1],a&&a.focus()},u=()=>{e.setAttribute("aria-hidden","true"),document.body.classList.remove("lb-open"),t.removeAttribute("src"),n.textContent="",n.hidden=!0,o=[],r=c=null,e.setAttribute("hidden",""),i&&"function"==typeof i.focus&&i.focus()};document.addEventListener("click",e=>{const t=e.target.closest(".gallery-link");if(!t||!t.closest(".gallery-container"))return;e.preventDefault();const n=t.getAttribute("href"),a=t.querySelector("img"),s=a?a.alt:"";n&&l(n,s)}),s&&s.addEventListener("click",u),a&&a.addEventListener("click",u),document.addEventListener("keydown",t=>{"false"===e.getAttribute("aria-hidden")&&("Escape"===t.key?(t.preventDefault(),u()):"Tab"===t.key&&(e=>{o.length&&(e.shiftKey&&document.activeElement===r?(e.preventDefault(),c.focus()):e.shiftKey||document.activeElement!==c||(e.preventDefault(),r.focus()))})(t))}),d||document.addEventListener("mouseenter",e=>{const t=e.target.closest(".gallery-link");if(!t||!t.closest(".gallery-container"))return;const n=t.getAttribute("href");if(!n)return;const a=new Image;a.decoding="async",a.src=n},!0)})(),(()=>{let e=!1,t=!1;const n=()=>{var t;(t=(window.scrollY||window.pageYOffset||0)>20)!==e&&(e=t,document.body.classList.toggle("header-compact",e))},a=()=>{t||(t=!0,requestAnimationFrame(()=>{n(),t=!1}))};n(),window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a),window.addEventListener("pageshow",n,{once:!0});const s=document.getElementById("hamburger");s&&s.addEventListener("click",()=>{setTimeout(n,0)});new MutationObserver(n).observe(document.body,{attributes:!0,attributeFilter:["class"]})})();