(()=>{const e=document.querySelectorAll(".hidden");if(!e.length)return;if(!("IntersectionObserver"in window))return void e.forEach(e=>e.classList.add("show"));const t=.12,n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.intersectionRatio>=t?requestAnimationFrame(()=>e.target.classList.add("show")):0===e.intersectionRatio&&e.target.classList.remove("show")})},{root:null,rootMargin:"0px 0px 10% 0px",threshold:[0,t,.5,1]});e.forEach(e=>n.observe(e));const i=()=>{e.forEach(e=>{((e,t=.12)=>{const n=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;if(0===n.width||0===n.height)return!1;const a=Math.min(n.bottom,i)-Math.max(n.top,0),s=Math.min(n.right,r)-Math.max(n.left,0);return!(a<=0||s<=0)&&a*s/(n.width*n.height)>=t})(e)&&e.classList.add("show")})};requestAnimationFrame(()=>requestAnimationFrame(i)),window.addEventListener("load",()=>setTimeout(i,0),{once:!0}),window.addEventListener("pageshow",()=>setTimeout(i,0),{once:!0})})(),(()=>{const e=document.getElementById("themeToggleDesktop"),t=document.getElementById("themeToggleMobile"),n=document.getElementById("hamburgerIcon"),i=window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null,r=(i,r=!0)=>{const a="dark"===i;document.body.classList.toggle("dark-mode",a),(e=>{document.querySelectorAll(".logo-img[data-light][data-dark]").forEach(t=>{const n=e?t.dataset.dark:t.dataset.light;if(!n)return;const i=new URL(n,document.baseURI).href;t.src!==i&&t.setAttribute("src",n)})})(a),(e=>{if(!n)return;const t=e?n.dataset.dark:n.dataset.light;t&&n.getAttribute("src")!==t&&n.setAttribute("src",t)})(a),(n=>{const i=String(n),r=n?"Przełącz na jasny motyw":"Przełącz na ciemny motyw";e&&(e.setAttribute("aria-pressed",i),e.setAttribute("aria-label",r)),t&&(t.setAttribute("aria-pressed",i),t.setAttribute("aria-label",r))})(a),r&&((e,t)=>{try{localStorage.setItem(e,t)}catch{}})("theme",a?"dark":"light")},a=(e=>{try{return localStorage.getItem(e)}catch{return null}})("theme");r("dark"===a||"light"===a?a:i&&i.matches?"dark":"light",!1);const s=()=>r(document.body.classList.contains("dark-mode")?"light":"dark",!0);if(e&&e.addEventListener("click",s),t&&t.addEventListener("click",s),!a&&i){const e=e=>r(e.matches?"dark":"light",!1);i.addEventListener?i.addEventListener("change",e):i.addListener&&i.addListener(e)}})(),(()=>{const e=document.getElementById("hamburger"),t=document.getElementById("primaryNav");if(!e||!t)return;const n=window.matchMedia("(max-width: 768px)");e.hasAttribute("aria-expanded")||e.setAttribute("aria-expanded","false");let i=null;const r=()=>document.body.classList.remove("nav-open"),a=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),t.toggleAttribute("inert",!1),t.setAttribute("aria-hidden","false"),r(),d()},s=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),t.toggleAttribute("inert",!0),t.setAttribute("aria-hidden","true"),r(),d()},o=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),t.toggleAttribute("inert",!0),t.setAttribute("aria-hidden","true"),r(),(i||e).focus({preventScroll:!0}),i=null,d()},c=()=>{t.classList.add("mobile-open"),e.classList.add("active"),e.setAttribute("aria-expanded","true"),e.setAttribute("aria-label","Zamknij menu"),t.toggleAttribute("inert",!1),t.setAttribute("aria-hidden","false"),document.body.classList.add("nav-open"),i=document.activeElement instanceof HTMLElement?document.activeElement:e,function(){if(l)return;l=n=>{if(!t.classList.contains("mobile-open"))return;const i=t.contains(n.target),r=e.contains(n.target);i||r||o()},document.addEventListener("pointerdown",l,!0)}()};e.addEventListener("click",()=>t.classList.contains("mobile-open")?o():c()),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("mobile-open")&&o()}),t.addEventListener("click",e=>{e.target.closest("a[href], area[href]")&&n.matches&&o()});let l=null;function d(){l&&(document.removeEventListener("pointerdown",l,!0),l=null)}const u=e=>{e.matches?s():a()};n.addEventListener?n.addEventListener("change",u):n.addListener&&n.addListener(u),n.matches?s():a()})(),(()=>{const e=document.getElementById("powrot-na-gore")||document.querySelector(".powrot-na-gore");if(!e)return;const t=document.scrollingElement||document.documentElement,n=()=>{return n=Math.max(0,"number"==typeof window.pageYOffset?window.pageYOffset:t.scrollTop)>300,e.classList.toggle("is-visible",n),e.setAttribute("aria-hidden",String(!n)),void(n?e.removeAttribute("inert"):e.setAttribute("inert",""));var n};let i=!1;n(),window.addEventListener("load",n,{once:!0}),window.addEventListener("pageshow",n,{once:!0}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&n()}),window.addEventListener("resize",n,{passive:!0}),window.addEventListener("scroll",()=>{i||(i=!0,requestAnimationFrame(()=>{n(),i=!1}))},{passive:!0}),e.addEventListener("click",t=>{if(t.preventDefault(),!e.classList.contains("is-visible"))return;const n=!window.matchMedia("(prefers-reduced-motion: reduce)").matches;window.scrollTo({top:0,behavior:n?"smooth":"auto"})})})(),(()=>{const e=document.getElementById("contactForm");if(!e)return;const t=/localhost|127\.0\.0\.1/.test(location.hostname),n=e.querySelector("#formStatus"),i=e.querySelector(".submit-btn"),r=i?i.textContent:"Wyślij wiadomość",a=["name","email","subject","service","message"],s=e.querySelector("#message"),o=document.getElementById("messageCounter"),c=500,l=e.querySelector("#errorSummary"),d=e.querySelector("#skipToError");d&&d.addEventListener("click",t=>{t.preventDefault();const n=e.querySelector(".is-invalid");n&&n.focus()}),e.addEventListener("keydown",t=>{const n=t.key||t.code;if(t.altKey&&t.shiftKey&&("E"===n||"KeyE"===n)){const n=e.querySelector(".is-invalid");n&&(t.preventDefault(),n.focus())}});const u=e=>{e&&(e.classList.add("is-invalid"),e.setAttribute("aria-invalid","true"))},m=(e,t=!1)=>{n&&(n.classList.toggle("ok",!!t),n.classList.toggle("err",!t),n.textContent=e)};function v(){if(!s||!o)return;s.value.length>c&&(s.value=s.value.slice(0,c));const e=s.value.length;o.textContent=`${e}/500`,o.classList.toggle("warn",e>=450&&e<c),o.classList.toggle("limit",e>=c)}v();const g="contactFormMessage";if(s){const e=(()=>{try{return localStorage.getItem(g)}catch{return null}})();e&&(s.value=e,v()),s.addEventListener("input",()=>{try{localStorage.setItem(g,s.value)}catch{}})}e.addEventListener("input",t=>{const n=t.target;var i;n.matches("#name, #email, #subject, #service, #message, #phone, #consent")&&((i=n)&&(i.classList.remove("is-invalid"),i.removeAttribute("aria-invalid"))),n===s&&v(),[...e.querySelectorAll(".is-invalid")].length||(l&&l.classList.add("visually-hidden"),d&&d.classList.add("visually-hidden"))}),e.addEventListener("submit",async o=>{if(o.preventDefault(),"true"===e.getAttribute("aria-busy"))return;m("",!1);let h=!0;a.forEach(t=>{const n=e.querySelector("#"+t);n&&n.value&&n.value.trim()||(u(n),h=!1)});const b=e.querySelector("#email"),y=b?b.value.trim():"";b&&y&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)&&(u(b),h=!1,m("Wpisz poprawny adres e-mail.",!1));const f=e.querySelector("#phone");if(f){const e=f.value.trim();e&&!/^[0-9 +()-]{7,20}$/.test(e)&&(u(f),h=!1,m("Wpisz poprawny numer telefonu (np. +48 600 000 000).",!1))}const w=e.querySelector("#consent");w&&!w.checked&&(u(w),h=!1,m("Zaznacz zgodę na przetwarzanie danych.",!1));if(e.querySelector("[data-recaptcha]")&&!t){const t=e.querySelector('[name="g-recaptcha-response"]');t&&t.value||(h=!1,m("Potwierdź, że nie jesteś robotem (reCAPTCHA).",!1))}if(s&&s.value.length>c&&(u(s),h=!1,m("Wiadomość może mieć maks. 500 znaków.",!1)),!h){const t=[...e.querySelectorAll(".is-invalid")];if(l){const n=t.map(t=>{const n=t.id?e.querySelector(`label[for="${t.id}"]`):null;return n?n.textContent.trim():t.name||t.id||"Pole"}),i=t.length,r=1===i?"błąd":i>=2&&i<=4?"błędy":"błędów";l.textContent=`Formularz zawiera ${i} ${r}: ${n.join(", ")}.`,l.classList.remove("visually-hidden")}d&&d.classList.remove("visually-hidden");const i=t[0];return i&&i.focus(),void(n&&!n.textContent&&m("Uzupełnij wymagane pola.",!1))}e.setAttribute("aria-busy","true"),i&&(i.disabled=!0,i.classList.add("sending"),i.textContent="Wysyłanie…"),m("Wysyłanie…",!0);const p=new FormData(e),L=new URLSearchParams(p).toString();try{if(t)await new Promise(e=>setTimeout(e,500));else{if(!(await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:L})).ok)throw new Error("Netlify response not OK")}e.setAttribute("aria-busy","false"),e.reset();try{localStorage.removeItem(g)}catch{}v(),m("Dziękujemy! Wiadomość została wysłana.",!0),i&&(i.classList.remove("sending"),i.classList.add("sent"),i.textContent="Wysłano ✓",setTimeout(()=>{i.disabled=!1},1200),setTimeout(()=>{m("",!0),i.classList.remove("sent"),i.textContent=r},6e3)),l&&l.classList.add("visually-hidden"),d&&d.classList.add("visually-hidden"),t||("function"==typeof gtag&&gtag("event","generate_lead",{event_category:"Formularz",event_label:"Kontakt — Budownictwo"}),"function"==typeof fbq&&fbq("track","Lead"))}catch(t){e.setAttribute("aria-busy","false"),i&&(i.disabled=!1,i.classList.remove("sending"),i.textContent=r),m("Ups! Nie udało się wysłać. Spróbuj ponownie za chwilę.",!1),console.error(t)}})})(),(()=>{const e=document.getElementById("lightbox");if(!e)return;const t=e.querySelector(".lb__img"),n=e.querySelector(".lb__caption"),i=e.querySelector(".lb__close"),r=e.querySelector(".lb__backdrop");let a=null,s=[],o=null,c=null;const l=window.matchMedia?window.matchMedia("(hover: none) and (pointer: coarse)").matches:"ontouchstart"in window,d=(r,l)=>{a=document.activeElement,t.src=r,t.alt=l||"",l&&l.trim()?(n.textContent=l,n.hidden=!1):(n.textContent="",n.hidden=!0),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("lb-open"),s=Array.from(e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled")&&null!==e.offsetParent),o=s[0],c=s[s.length-1],i&&i.focus()},u=()=>{e.setAttribute("aria-hidden","true"),document.body.classList.remove("lb-open"),t.removeAttribute("src"),n.textContent="",n.hidden=!0,s=[],o=c=null,e.setAttribute("hidden",""),a&&"function"==typeof a.focus&&a.focus()};document.addEventListener("click",e=>{const t=e.target.closest(".gallery-link");if(!t||!t.closest(".gallery-container"))return;e.preventDefault();const n=t.getAttribute("href"),i=t.querySelector("img"),r=i?i.alt:"";n&&d(n,r)}),r&&r.addEventListener("click",u),i&&i.addEventListener("click",u),document.addEventListener("keydown",t=>{"false"===e.getAttribute("aria-hidden")&&("Escape"===t.key?(t.preventDefault(),u()):"Tab"===t.key&&(e=>{s.length&&(e.shiftKey&&document.activeElement===o?(e.preventDefault(),c.focus()):e.shiftKey||document.activeElement!==c||(e.preventDefault(),o.focus()))})(t))}),l||document.addEventListener("mouseenter",e=>{const t=e.target;if(!t||1!==t.nodeType||"function"!=typeof t.closest)return;const n=t.closest(".gallery-link");if(!n||!n.closest(".gallery-container"))return;const i=n.getAttribute("href");if(!i)return;const r=new Image;r.decoding="async",r.src=i},!0)})(),(()=>{let e=!1,t=!1;const n=()=>{var t;(t=(window.scrollY||window.pageYOffset||0)>20)!==e&&(e=t,document.body.classList.toggle("header-compact",e))},i=()=>{t||(t=!0,requestAnimationFrame(()=>{n(),t=!1}))};n(),window.addEventListener("scroll",i,{passive:!0}),window.addEventListener("resize",i),window.addEventListener("pageshow",n,{once:!0});const r=document.getElementById("hamburger");r&&r.addEventListener("click",()=>{setTimeout(n,0)});new MutationObserver(n).observe(document.body,{attributes:!0,attributeFilter:["class"]})})(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(()=>console.log("✅ Service Worker registered")).catch(e=>console.error("❌ Service Worker registration failed:",e))});