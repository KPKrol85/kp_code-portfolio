(()=>{const e=document.querySelectorAll(".hidden");if(!e.length)return;if(!("IntersectionObserver"in window))return void e.forEach(e=>e.classList.add("show"));const t=.12,n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.intersectionRatio>=t?requestAnimationFrame(()=>e.target.classList.add("show")):0===e.intersectionRatio&&e.target.classList.remove("show")})},{root:null,rootMargin:"0px 0px 10% 0px",threshold:[0,t,.5,1]});e.forEach(e=>n.observe(e));const a=()=>{e.forEach(e=>{((e,t=.12)=>{const n=e.getBoundingClientRect(),a=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;if(0===n.width||0===n.height)return!1;const r=Math.min(n.bottom,a)-Math.max(n.top,0),s=Math.min(n.right,i)-Math.max(n.left,0);return!(r<=0||s<=0)&&r*s/(n.width*n.height)>=t})(e)&&e.classList.add("show")})};requestAnimationFrame(()=>requestAnimationFrame(a)),window.addEventListener("load",()=>setTimeout(a,0),{once:!0}),window.addEventListener("pageshow",()=>setTimeout(a,0),{once:!0})})(),(()=>{const e=document.getElementById("themeToggleDesktop"),t=document.getElementById("themeToggleMobile"),n=document.getElementById("hamburgerIcon"),a=window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null,i=(a,i=!0)=>{const r="dark"===a;document.body.classList.toggle("dark-mode",r),(e=>{document.querySelectorAll(".logo-img[data-light][data-dark]").forEach(t=>{const n=e?t.dataset.dark:t.dataset.light;if(!n)return;const a=new URL(n,document.baseURI).href;t.src!==a&&t.setAttribute("src",n)})})(r),(e=>{if(!n)return;const t=e?n.dataset.dark:n.dataset.light;t&&n.getAttribute("src")!==t&&n.setAttribute("src",t)})(r),(n=>{const a=String(n),i=n?"Przełącz na jasny motyw":"Przełącz na ciemny motyw";e&&(e.setAttribute("aria-pressed",a),e.setAttribute("aria-label",i)),t&&(t.setAttribute("aria-pressed",a),t.setAttribute("aria-label",i))})(r),i&&((e,t)=>{try{localStorage.setItem(e,t)}catch{}})("theme",r?"dark":"light")},r=(e=>{try{return localStorage.getItem(e)}catch{return null}})("theme");i("dark"===r||"light"===r?r:a&&a.matches?"dark":"light",!1);const s=()=>i(document.body.classList.contains("dark-mode")?"light":"dark",!0);if(e&&e.addEventListener("click",s),t&&t.addEventListener("click",s),!r&&a){const e=e=>i(e.matches?"dark":"light",!1);a.addEventListener?a.addEventListener("change",e):a.addListener&&a.addListener(e)}})(),(()=>{const e=document.getElementById("hamburger"),t=document.getElementById("primaryNav");if(!e||!t)return;const n=window.matchMedia("(max-width: 768px)");e.hasAttribute("aria-expanded")||e.setAttribute("aria-expanded","false");let a=null;const i=()=>document.body.classList.remove("nav-open"),r=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),t.toggleAttribute("inert",!1),t.setAttribute("aria-hidden","false"),i(),d()},s=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),t.toggleAttribute("inert",!0),t.setAttribute("aria-hidden","true"),i(),d()},o=()=>{t.classList.remove("mobile-open"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-label","Otwórz menu"),t.toggleAttribute("inert",!0),t.setAttribute("aria-hidden","true"),i(),(a||e).focus({preventScroll:!0}),a=null,d()},c=()=>{t.classList.add("mobile-open"),e.classList.add("active"),e.setAttribute("aria-expanded","true"),e.setAttribute("aria-label","Zamknij menu"),t.toggleAttribute("inert",!1),t.setAttribute("aria-hidden","false"),document.body.classList.add("nav-open"),a=document.activeElement instanceof HTMLElement?document.activeElement:e,function(){if(l)return;l=n=>{if(!t.classList.contains("mobile-open"))return;const a=t.contains(n.target),i=e.contains(n.target);a||i||o()},document.addEventListener("pointerdown",l,!0)}()};e.addEventListener("click",()=>t.classList.contains("mobile-open")?o():c()),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("mobile-open")&&o()}),t.addEventListener("click",e=>{e.target.closest("a[href], area[href]")&&n.matches&&o()});let l=null;function d(){l&&(document.removeEventListener("pointerdown",l,!0),l=null)}const u=e=>{e.matches?s():r()};n.addEventListener?n.addEventListener("change",u):n.addListener&&n.addListener(u),n.matches?s():r()})(),(()=>{const e=document.getElementById("powrot-na-gore")||document.querySelector(".powrot-na-gore");if(!e)return;const t=document.scrollingElement||document.documentElement,n=()=>{return n=Math.max(0,"number"==typeof window.pageYOffset?window.pageYOffset:t.scrollTop)>300,e.classList.toggle("is-visible",n),e.setAttribute("aria-hidden",String(!n)),void(n?e.removeAttribute("inert"):e.setAttribute("inert",""));var n};let a=!1;n(),window.addEventListener("load",n,{once:!0}),window.addEventListener("pageshow",n,{once:!0}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&n()}),window.addEventListener("resize",n,{passive:!0}),window.addEventListener("scroll",()=>{a||(a=!0,requestAnimationFrame(()=>{n(),a=!1}))},{passive:!0}),e.addEventListener("click",t=>{if(t.preventDefault(),!e.classList.contains("is-visible"))return;const n=!window.matchMedia("(prefers-reduced-motion: reduce)").matches;window.scrollTo({top:0,behavior:n?"smooth":"auto"})})})(),(()=>{const e=document.getElementById("contactForm");if(!e)return;const t=/localhost|127\.0\.0\.1/.test(location.hostname),n=e.querySelector("#formStatus"),a=e.querySelector(".submit-btn"),i=a?a.textContent:"Wyślij wiadomość",r=["name","email","subject","service","message"],s=e.querySelector("#message"),o=document.getElementById("messageCounter"),c=500,l=e.querySelector("#errorSummary"),d=e.querySelector("#skipToError");d&&d.addEventListener("click",t=>{t.preventDefault();const n=e.querySelector(".is-invalid");n&&n.focus()}),e.addEventListener("keydown",t=>{const n=t.key||t.code;if(t.altKey&&t.shiftKey&&("E"===n||"KeyE"===n)){const n=e.querySelector(".is-invalid");n&&(t.preventDefault(),n.focus())}});const u=e=>{e&&(e.classList.add("is-invalid"),e.setAttribute("aria-invalid","true"))},m=(e,t=!1)=>{n&&(n.classList.toggle("ok",!!t),n.classList.toggle("err",!t),n.textContent=e)};function h(){if(!s||!o)return;s.value.length>c&&(s.value=s.value.slice(0,c));const e=s.value.length;o.textContent=`${e}/500`,o.classList.toggle("warn",e>=450&&e<c),o.classList.toggle("limit",e>=c)}h();const g="contactFormMessage";if(s){const e=(()=>{try{return localStorage.getItem(g)}catch{return null}})();e&&(s.value=e,h()),s.addEventListener("input",()=>{try{localStorage.setItem(g,s.value)}catch{}})}e.addEventListener("input",t=>{const n=t.target;var a;n.matches("#name, #email, #subject, #service, #message, #phone, #consent")&&((a=n)&&(a.classList.remove("is-invalid"),a.removeAttribute("aria-invalid"))),n===s&&h(),[...e.querySelectorAll(".is-invalid")].length||(l&&l.classList.add("visually-hidden"),d&&d.classList.add("visually-hidden"))}),e.addEventListener("submit",async o=>{if(o.preventDefault(),"true"===e.getAttribute("aria-busy"))return;m("",!1);let v=!0;r.forEach(t=>{const n=e.querySelector("#"+t);n&&n.value&&n.value.trim()||(u(n),v=!1)});const b=e.querySelector("#email"),y=b?b.value.trim():"";b&&y&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)&&(u(b),v=!1,m("Wpisz poprawny adres e-mail.",!1));const f=e.querySelector("#phone");if(f){const e=f.value.trim();e&&!/^[0-9 +()-]{7,20}$/.test(e)&&(u(f),v=!1,m("Wpisz poprawny numer telefonu (np. +48 600 000 000).",!1))}const w=e.querySelector("#consent");w&&!w.checked&&(u(w),v=!1,m("Zaznacz zgodę na przetwarzanie danych.",!1));if(e.querySelector("[data-recaptcha]")&&!t){const t=e.querySelector('[name="g-recaptcha-response"]');t&&t.value||(v=!1,m("Potwierdź, że nie jesteś robotem (reCAPTCHA).",!1))}if(s&&s.value.length>c&&(u(s),v=!1,m("Wiadomość może mieć maks. 500 znaków.",!1)),!v){const t=[...e.querySelectorAll(".is-invalid")];if(l){const n=t.map(t=>{const n=t.id?e.querySelector(`label[for="${t.id}"]`):null;return n?n.textContent.trim():t.name||t.id||"Pole"}),a=t.length,i=1===a?"błąd":a>=2&&a<=4?"błędy":"błędów";l.textContent=`Formularz zawiera ${a} ${i}: ${n.join(", ")}.`,l.classList.remove("visually-hidden")}d&&d.classList.remove("visually-hidden");const a=t[0];return a&&a.focus(),void(n&&!n.textContent&&m("Uzupełnij wymagane pola.",!1))}e.setAttribute("aria-busy","true"),a&&(a.disabled=!0,a.classList.add("sending"),a.textContent="Wysyłanie…"),m("Wysyłanie…",!0);const p=new FormData(e),L=new URLSearchParams(p).toString();try{if(t)await new Promise(e=>setTimeout(e,500));else{if(!(await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:L})).ok)throw new Error("Netlify response not OK")}e.setAttribute("aria-busy","false"),e.reset();try{localStorage.removeItem(g)}catch{}h(),m("Dziękujemy! Wiadomość została wysłana.",!0),a&&(a.classList.remove("sending"),a.classList.add("sent"),a.textContent="Wysłano ✓",setTimeout(()=>{a.disabled=!1},1200),setTimeout(()=>{m("",!0),a.classList.remove("sent"),a.textContent=i},6e3)),l&&l.classList.add("visually-hidden"),d&&d.classList.add("visually-hidden"),t||("function"==typeof gtag&&gtag("event","generate_lead",{event_category:"Formularz",event_label:"Kontakt — Budownictwo"}),"function"==typeof fbq&&fbq("track","Lead"))}catch(t){e.setAttribute("aria-busy","false"),a&&(a.disabled=!1,a.classList.remove("sending"),a.textContent=i),m("Ups! Nie udało się wysłać. Spróbuj ponownie za chwilę.",!1),console.error(t)}})})(),(()=>{const e=document.getElementById("lightbox");if(!e)return;const t=e.querySelector(".lb__img"),n=e.querySelector(".lb__caption"),a=e.querySelector(".lb__close"),i=e.querySelector(".lb__backdrop");let r=null,s=[],o=null,c=null;const l=window.matchMedia?window.matchMedia("(hover: none) and (pointer: coarse)").matches:"ontouchstart"in window,d=(i,l)=>{r=document.activeElement,t.src=i,t.alt=l||"",l&&l.trim()?(n.textContent=l,n.hidden=!1):(n.textContent="",n.hidden=!0),e.removeAttribute("hidden"),e.setAttribute("aria-hidden","false"),document.body.classList.add("lb-open"),s=Array.from(e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled")&&null!==e.offsetParent),o=s[0],c=s[s.length-1],a&&a.focus()},u=()=>{e.setAttribute("aria-hidden","true"),document.body.classList.remove("lb-open"),t.removeAttribute("src"),n.textContent="",n.hidden=!0,s=[],o=c=null,e.setAttribute("hidden",""),r&&"function"==typeof r.focus&&r.focus()};document.addEventListener("click",e=>{const t=e.target.closest(".gallery-link");if(!t||!t.closest(".gallery-container"))return;e.preventDefault();const n=t.getAttribute("href"),a=t.querySelector("img"),i=a?a.alt:"";n&&d(n,i)}),i&&i.addEventListener("click",u),a&&a.addEventListener("click",u),document.addEventListener("keydown",t=>{"false"===e.getAttribute("aria-hidden")&&("Escape"===t.key?(t.preventDefault(),u()):"Tab"===t.key&&(e=>{s.length&&(e.shiftKey&&document.activeElement===o?(e.preventDefault(),c.focus()):e.shiftKey||document.activeElement!==c||(e.preventDefault(),o.focus()))})(t))}),l||document.addEventListener("mouseenter",e=>{const t=e.target.closest(".gallery-link");if(!t||!t.closest(".gallery-container"))return;const n=t.getAttribute("href");if(!n)return;const a=new Image;a.decoding="async",a.src=n},!0)})(),(()=>{let e=!1,t=!1;const n=()=>{var t;(t=(window.scrollY||window.pageYOffset||0)>20)!==e&&(e=t,document.body.classList.toggle("header-compact",e))},a=()=>{t||(t=!0,requestAnimationFrame(()=>{n(),t=!1}))};n(),window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a),window.addEventListener("pageshow",n,{once:!0});const i=document.getElementById("hamburger");i&&i.addEventListener("click",()=>{setTimeout(n,0)});new MutationObserver(n).observe(document.body,{attributes:!0,attributeFilter:["class"]})})();